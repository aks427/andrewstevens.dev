(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"0PNO":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("TJpk"),u=r("Bl7J");function a(e){const t=e.peek(),r=e.getPreviousToken(),n=r?r.type:null;return'"'===t?(e.next(),"string"===n||"start quote"===n?"end quote":"start quote"):'"'!==t&&"start quote"===n&&'"'===r.value?(e.match(/^[^"]+(?=")/,!0)||e.match(/^[^"]+/,!0),"string"):e.match(/^[-]?\d*\.?\d+/,!1)?"-"===t&&"operator"!==n&&c(r)?(e.next(),"operator"):(e.match(/^[-]?\d*\.?\d+/,!0),"number"):["&","*","-","+","/"].indexOf(t)>-1?(e.next(),"operator"):"bracket"===n&&"["===r.value&&e.match(/^[^[\]]+(?=\])/,!0)?"reference-name":e.match(/^[a-zA-Z_]\w*(?=\()/,!0)?"function-name":[")","]","(","["].indexOf(t)>-1?(e.next(),"bracket"):","===t?(e.next(),"comma"):e.match(/^ +/,!0)?"whitespace":(e.next(),"error")}function c(e){return!!e&&("number"===e.type||"end quote"===e.type||"bracket"===e.type&&(")"===e.value||"]"===e.value))}const s={"&":function(e){return e.join("")},"+":function(e){return Number(e[0])+Number(e[1])},"-":function(e){return Number(e[0])-Number(e[1])},"/":function(e){return Number(e[0])/Number(e[1])},"*":function(e){return Number(e[0])*Number(e[1])}};const l={upper:function(e){if(e.length>0)return e[0].toUpperCase();return""},round:function(e){if(e.length>0)return Math.round(e[0]);return""}};function i(e){return!e||("operator"===e.type||"comma"===e.type||"bracket"===e.type&&"("===e.value)}r("TpD0");var p=r("qKvR");function f(e){const{value:t,onChange:r,onErrorsChanged:o,onTokensChanged:u}=e,s=Object(n.useRef)(),f=Object(n.useRef)(),{0:h,1:b}=Object(n.useState)(30),{0:m,1:d}=Object(n.useState)([]),{0:v,1:g}=Object(n.useState)([]);Object(n.useEffect)(()=>{const e=function(e,t){let r=0;const n=[],o=()=>r>=e.length,u=()=>o()?null:e.substring(r,r+1),a=(t,n)=>{const o=e.substring(r).match(t);return!o||o.length>1?null:(n&&(r+=o[0].length),o[0]||null)},c=()=>(r+=1,u()),s=()=>{for(let e=n.length-1;e>=0;e--)if("whitespace"!==n[e].type)return n[e];return null};for(;!o();){const l=r,i=t({peek:u,match:a,next:c,isEnd:o,getPreviousToken:s});if(l===r)throw new Error("Tokenizer did not move forward");const p={value:e.substring(l,r),type:i};n.push(p)}return n}(t,a),r=function(e){const t=[],r=[];let n=null,o=0;const u=e.filter(e=>"whitespace"!==e.type);for(let s=0;s<u.length;s++){const e=u[s],p=n?n.type:null;"operator"===e.type&&(c(n)||t.push({token:e,error:`Unexpected operator '${e.value}'`}),s===u.length-1&&t.push({token:e,error:`Value expected after operator '${e.value}'`})),"number"===e.type&&(i(n)||t.push({token:e,error:"An operator is required before the number"})),"function-name"===e.type&&(i(n)||t.push({token:e,error:"An operator is required before the function"}),a=e.value,l[a.toLowerCase()]||t.push({token:e,error:`'${e.value}' is not a valid function`})),"start quote"===e.type&&(r.push({text:'"',type:"reference",token:e}),i(n)||t.push({token:e,error:"An operator is required before the string"})),"end quote"===e.type&&r.length>0&&'"'===r[r.length-1].text&&r.pop(),"comma"===e.type&&(!o>0&&t.push({token:e,error:"Unexpected ','"}),c(n)||t.push({token:e,error:"Unexpected ','"})),"bracket"===e.type&&("("===e.value&&(r.push({text:"(",type:"function-name"===p?"function":"group",token:e}),"function-name"===p&&(o+=1),"function-name"===p||i(n)||t.push({token:e,error:"An operator is required before the parenthesis"})),")"===e.value&&(r.length>0&&"("===r[r.length-1].text?("function"===r[r.length-1].type&&o--,r.pop(),c(n)||"start-parenthesis"===p&&"function"===r[r.length-1].type||t.push({token:e,error:"Unexpected ')'"})):t.push({token:e,error:"Unexpected ')'"})),"["===e.value&&(r.push({text:"[",type:"reference",token:e}),i(n)||t.push({token:e,error:"An operator is required before the reference"})),"]"===e.value&&(r.length>0&&"["===r[r.length-1].text?("reference-name"!==p&&t.push({token:e,error:"A reference name is required in the brackets"}),r.pop()):t.push({token:e,error:"Unexpected ']'"}))),n=e}var a;for(const c of r){let e=c.text;"("===c.text?e=")":"["===c.text&&(e="]"),t.push({token:c.token,error:`Missing closing '${e}'`})}return t}(e);d(e),g(r),u&&u(e),o&&o(r)},[t,u,o]),Object(n.useLayoutEffect)(()=>{const e=s.current,t=()=>{f.current.scrollTop=s.current.scrollTop,f.current.scrollLeft=s.current.scrollLeft};return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}},[s]),Object(n.useLayoutEffect)(()=>{s.current.style.height="auto",s.current.style.height=Math.min(s.current.scrollHeight+2,200)+"px",b(s.current.scrollHeight+2)},[t]);return Object(p.b)("div",{className:"formula-editor"},Object(p.b)("textarea",{value:t,onChange:e=>{let t=e.target.value;t&&(t=t.replace(/(?:\r\n|\r|\n)/g,"")),r(t)},className:"formula-editor-textarea",ref:s,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",height:h,rows:1}),Object(p.b)("div",{className:"formula-editor-formatted",ref:f},function(e,t){let r=[];for(let n=0;n<e.length;n++){const o=e[n],u=[o.type];t.filter(e=>e.token===o).length>0&&u.push("error"),r.push(Object(p.b)("span",{key:n,className:u.join(" ")},o.value))}return r}(m,v)))}function h(e,t){const r=e[e.length-1];r&&"operator"===r.type&&r.innerNodes.length<2?r.innerNodes.push(t):e.push(t)}function b(e){const t=[],r=[];let n;for(n=0;n<e.length;n++){if("bracket"===e[n].type){if(")"===e[n].value&&"("===r[r.length-1]&&(r.pop(),0===r.length)){n++;break}if("("===e[n].value&&(r.push(e[n].value),0===n))continue}t.push(e[n])}return{tokens:t,i:n-1}}function m(e,t){const r=function e(t){const r=[],n=t.filter(e=>"whitespace"!==e.type);for(let o=0;o<n.length;o++){const t=n[o];if(!(["start quote","end quote"].indexOf(t.type)>-1)){if(["string","number"].indexOf(t.type)>-1&&h(r,{type:t.type,value:t.value}),"operator"===t.type){const e=r[r.length-1];r.pop(),r.push({type:"operator",value:t.value,innerNodes:[e]})}if("reference-name"===t.type&&h(r,{type:"reference",value:t.value}),"function-name"===t.type){let u=[];if(o++,n[o]&&"bracket"===n[o].type&&"("===n[o].value){const e=b(n.slice(o));u=e.tokens,o+=e.i}h(r,{type:"function",value:t.value,innerNodes:e(u)})}if("bracket"===t.type&&"("===t.value){const t=b(n.slice(o));o+=t.i;const u=t.tokens;h(r,{type:"group",innerNodes:u?e(u):null})}}}return console.log(JSON.stringify(r)),r}(e);let n="";for(const o of r)n+=d(o,t);return n}function d(e,t){if(!e)return"";if("operator"===e.type){const r=e.innerNodes.map(e=>d(e,t));return function(e,t){const r=s[e];return r?r(t):""}(e.value,r)}if("function"===e.type){const r=e.innerNodes.map(e=>d(e,t));return function(e,t){const r=l[e.toLowerCase()];return r?r(t):""}(e.value,r)}return"reference"===e.type?t[e.value]||"":"string"===e.type||"number"===e.type?e.value:""}function v(e,t){let r=function(e){if(!e)return null;return JSON.parse(JSON.stringify(e))}(e);return r[t.propertyName]=t.value,r}r("XuOu"),t.default=()=>{const{0:e,1:t}=Object(n.useState)('"Hello " & [First Name] & "! " & Round(1.2 + [Some Number])'),{0:r,1:a}=Object(n.useState)([]),{0:c,1:s}=Object(n.useState)([]),[l,i]=function(e){const{0:t,1:r}=Object(n.useReducer)(v,e);return[t,(e,t)=>{r({propertyName:e,value:t})}]}({"First Name":"Andrew","Some Number":3}),h=function(e){return e.filter(e=>"reference-name"===e.type).map(e=>e.value).filter((e,t,r)=>r.indexOf(e)===t)}(c),b=m(c,l);return Object(p.b)(u.a,null,Object(p.b)(o.Helmet,null,Object(p.b)("title",null,"Parser Example")),Object(p.b)("div",{className:"formula-example"},Object(p.b)("p",null,"This is an example for the ",Object(p.b)("a",{href:"/posts/formula-parser-in-javascript"},"Write a simple formula parser in JavaScript")," post."),Object(p.b)("p",null,"This shows the editor, validator and evaluator all working together."),Object(p.b)("h3",null,"Editor"),Object(p.b)(f,{value:e,onChange:t,onErrorsChanged:a,onTokensChanged:s}),r.map((e,t)=>Object(p.b)("div",{key:t,className:"error"},e.error)),h.length>0?Object(p.b)("h3",null,"References"):null,h.map(e=>Object(p.b)("div",{key:e,className:"input-value"},Object(p.b)("div",null,e),Object(p.b)("input",{value:l[e]||"",onChange:t=>i(e,t.target.value)}))),Object(p.b)("h3",null,"Result"),Object(p.b)("div",{className:"result"},b)))}},TpD0:function(e,t,r){},XuOu:function(e,t,r){}}]);
//# sourceMappingURL=component---src-pages-posts-formula-parser-in-javascript-example-index-js-d5944bfe1e261dc1c9c9.js.map